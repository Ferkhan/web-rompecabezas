<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rompecabezas - Ajustes</title>
    <!-- CSS Global compartido -->
    <link rel="stylesheet" href="../css/styles.css">
    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Skip link accesible por teclado -->
    <a class="skip-link" href="#contenido-principal">Saltar al contenido principal</a>

    <!-- ========================================== -->
    <!-- RECURSOS GLOBALES SVG (SOLUCIÓN DE COLOR) -->
    <!-- Necesario para que los degradados del personaje se vean en esta página -->
    <!-- ========================================== -->
    <svg width="0" height="0" style="position: absolute; overflow: hidden;" aria-hidden="true">
        <defs>
            <!-- 1. Superhéroe Gradients -->
            <linearGradient id="globalSuitGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#3B82F6;stop-opacity:1"/><stop offset="50%" style="stop-color:#2563EB;stop-opacity:1"/><stop offset="100%" style="stop-color:#1D4ED8;stop-opacity:1"/></linearGradient>
            <linearGradient id="globalCapeGradient" x1="50%" y1="0%" x2="50%" y2="100%"><stop offset="0%" style="stop-color:#EF4444;stop-opacity:1"/><stop offset="100%" style="stop-color:#991B1B;stop-opacity:1"/></linearGradient>
            <linearGradient id="globalSkinGradient" x1="0%" y1="0%" x2="100%" y2="50%"><stop offset="0%" style="stop-color:#FFE4C4;stop-opacity:1"/><stop offset="100%" style="stop-color:#F5C19B;stop-opacity:1"/></linearGradient>
            <linearGradient id="globalGoldGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FCD34D;stop-opacity:1"/><stop offset="50%" style="stop-color:#F59E0B;stop-opacity:1"/><stop offset="100%" style="stop-color:#B45309;stop-opacity:1"/></linearGradient>
            
            <!-- 2. Robot Gradients -->
            <linearGradient id="globalMetalGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#E5E7EB;stop-opacity:1"/><stop offset="50%" style="stop-color:#9CA3AF;stop-opacity:1"/><stop offset="100%" style="stop-color:#4B5563;stop-opacity:1"/></linearGradient>
            <linearGradient id="globalBlueEye" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#60A5FA;stop-opacity:1"/><stop offset="100%" style="stop-color:#2563EB;stop-opacity:1"/></linearGradient>
            
            <!-- 3. Mascota Gradients -->
            <linearGradient id="globalDogFur" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1"/><stop offset="100%" style="stop-color:#B45309;stop-opacity:1"/></linearGradient>
            
            <!-- 4. Héroe Alternativo Gradients -->
            <linearGradient id="globalAltSuit" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#10B981;stop-opacity:1"/><stop offset="100%" style="stop-color:#047857;stop-opacity:1"/></linearGradient>
            <linearGradient id="globalAltCape" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1"/><stop offset="100%" style="stop-color:#5B21B6;stop-opacity:1"/></linearGradient>
            <linearGradient id="globalSkinGradientAlt" x1="0%" y1="0%" x2="100%" y2="50%"><stop offset="0%" style="stop-color:#FFE4C4;stop-opacity:1"/><stop offset="100%" style="stop-color:#F5C19B;stop-opacity:1"/></linearGradient>
        </defs>
    </svg>

    <!-- Fondo decorativo -->
    <div class="bg-pattern" aria-hidden="true"></div>

    <!-- Panel de Información de Usuario -->
    <div class="user-info-panel highlight" id="user-info-panel" aria-hidden="true" aria-label="Estado de la sesión del usuario">
        <div class="info-item"><strong>Usuario invitado</strong></div>
        <div class="info-item">Tiempo: <span id="user-time-display">Libre</span></div>
        <div class="info-item">Nivel: <span id="user-level-display">Fácil</span></div>
    </div>

    <main class="game-container" id="contenido-principal" tabindex="-1">
        <section id="settings-screen" class="screen-section active" aria-labelledby="titulo-ajustes">

            <h1 id="titulo-ajustes" class="settings-title">Ajustes de Rompecabezas</h1>
            <p class="sr-only">Configura la dificultad, tamaño, estímulos y tiempo límite del rompecabezas. Usa Tab para navegar por las opciones y Enter para seleccionar.</p>

            <div class="settings-grid-layout">
                <!-- Panel Izquierdo: Formulario -->
                <form id="settings-form" class="settings-controls" aria-labelledby="titulo-ajustes" aria-describedby="ayuda-form" novalidate>
                    <p id="ayuda-form" class="sr-only">Usa Tab para moverte entre los campos del formulario. Usa las flechas del teclado para seleccionar opciones en los grupos de radio.</p>
                    
                    <!-- Dificultad -->
                    <fieldset class="control-group group-difficulty">
                        <legend id="legend-difficulty">Dificultad</legend>
                        <p id="help-difficulty" class="form-help">Selecciona el nivel de dificultad del rompecabezas. Fácil tiene menos piezas, Difícil tiene más piezas complejas.</p>
                        <div class="radio-options" role="radiogroup" aria-labelledby="legend-difficulty">
                            <label class="custom-radio" for="diff-easy">
                                <input type="radio" id="diff-easy" name="difficulty" value="easy" checked required>
                                <span class="radio-btn">Fácil</span>
                            </label>
                            <label class="custom-radio" for="diff-medium">
                                <input type="radio" id="diff-medium" name="difficulty" value="medium" required>
                                <span class="radio-btn">Medio</span>
                            </label>
                            <label class="custom-radio" for="diff-hard">
                                <input type="radio" id="diff-hard" name="difficulty" value="hard" required>
                                <span class="radio-btn">Difícil</span>
                            </label>
                        </div>
                        <span class="error-message" id="error-difficulty" role="alert" aria-live="assertive"></span>
                    </fieldset>

                    <!-- Tamaño -->
                    <fieldset class="control-group group-size">
                        <legend id="legend-size">Tamaño del tablero</legend>
                        <p id="help-size" class="form-help">Elige el tamaño de la cuadrícula del rompecabezas. 3x3 tiene 9 piezas, 4x4 tiene 16 piezas, 5x5 tiene 25 piezas.</p>
                        <div class="radio-options" role="radiogroup" aria-labelledby="legend-size">
                            <label class="custom-radio" for="size-3">
                                <input type="radio" id="size-3" name="size" value="3" checked required>
                                <span class="radio-btn">3x3</span>
                            </label>
                            <label class="custom-radio" for="size-4">
                                <input type="radio" id="size-4" name="size" value="4" required>
                                <span class="radio-btn">4x4</span>
                            </label>
                            <label class="custom-radio" for="size-5">
                                <input type="radio" id="size-5" name="size" value="5" required>
                                <span class="radio-btn">5x5</span>
                            </label>
                        </div>
                        <span class="error-message" id="error-size" role="alert" aria-live="assertive"></span>
                    </fieldset>

                    <!-- Estímulos -->
                    <fieldset class="control-group group-stimuli">
                        <legend id="legend-stimuli">Retroalimentación</legend>
                        <p id="help-stimuli" class="form-help">Tipo de retroalimentación durante el juego. Visual muestra animaciones, Auditivo reproduce sonidos, Ambos combina los dos.</p>
                        <div class="radio-options" role="radiogroup" aria-labelledby="legend-stimuli">
                            <label class="custom-radio" for="stimuli-visual">
                                <input type="radio" id="stimuli-visual" name="stimuli" value="visual" checked required>
                                <span class="radio-btn">Visual</span>
                            </label>
                            <label class="custom-radio" for="stimuli-sound">
                                <input type="radio" id="stimuli-sound" name="stimuli" value="sound" required>
                                <span class="radio-btn">Auditivo</span>
                            </label>
                            <label class="custom-radio" for="stimuli-mixed">
                                <input type="radio" id="stimuli-mixed" name="stimuli" value="mixed" required>
                                <span class="radio-btn">Ambos</span>
                            </label>
                        </div>
                        <span class="error-message" id="error-stimuli" role="alert" aria-live="assertive"></span>
                    </fieldset>

                    <!-- Tiempo -->
                    <fieldset class="control-group group-time">
                        <legend id="legend-time">Límite de tiempo</legend>
                        <p id="help-time" class="form-help">Tiempo máximo para completar el rompecabezas. 3 minutos es desafiante, 5 minutos es moderado, Libre significa sin límite de tiempo.</p>
                        <div class="radio-options" role="radiogroup" aria-labelledby="legend-time">
                            <label class="custom-radio" for="time-3min">
                                <input type="radio" id="time-3min" name="time" value="3min" required>
                                <span class="radio-btn">3 Min</span>
                            </label>
                            <label class="custom-radio" for="time-5min">
                                <input type="radio" id="time-5min" name="time" value="5min" required>
                                <span class="radio-btn">5 Min</span>
                            </label>
                            <label class="custom-radio" for="time-free">
                                <input type="radio" id="time-free" name="time" value="free" checked required>
                                <span class="radio-btn">Libre</span>
                            </label>
                        </div>
                        <span class="error-message" id="error-time" role="alert" aria-live="assertive"></span>
                    </fieldset>
                </form>

                <!-- Panel Derecho: Previsualización -->
                <div class="settings-preview-panel">
                    <h2 id="titulo-preview">Vista Previa</h2>
                    <p class="sr-only">Visualización en tiempo real de cómo se verá tu tablero de rompecabezas con la configuración seleccionada.</p>
                    <div class="preview-card" role="img" aria-labelledby="titulo-preview" aria-describedby="desc-preview">
                        <div class="preview-grid" id="preview-grid-container" style="--grid-size: 3;" role="presentation"></div>

                        <div class="preview-badges" role="status" aria-live="polite">
                            <span id="badge-difficulty" class="badge" aria-label="Dificultad seleccionada">Fácil</span>
                            <span id="badge-time" class="badge" aria-label="Tiempo seleccionado">Libre</span>
                        </div>
                        <p id="desc-preview" class="sr-only">El tablero mostrará una cuadrícula con las piezas del rompecabezas según tu configuración actual.</p>
                    </div>
                </div>

                <!-- Botonera Inferior -->
                <div class="settings-actions" >
                    <button type="button" class="btn-small btn-default" id="btn-default" aria-label="Restablecer: Vuelve a la configuración predeterminada del juego">Restablecer</button>
                    <button type="button" class="btn-small btn-assist" id="btn-assist" aria-label="Personalizar Asistente: Cambia la apariencia de tu asistente virtual entre superhéroe, robot, mascota o héroe alternativo">Personalizar Asistente</button>
                    <!-- Este botón guardará y regresará a index.html -->
                    <button type="button" class="btn-large btn-save" id="btn-save" aria-label="Guardar y continuar: Guarda tu configuración y regresa al menú principal">Continuar</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Mascota con mensaje específico para Ajustes -->
    <aside class="mascot-section" aria-labelledby="mascot-text" aria-hidden="true">
        <div class="speech-bubble" id="mascot-text" role="status" aria-live="polite">
            Configura tu desafío. Recuerda: ¡tú controlas la dificultad!
        </div>

        <!-- CORRECCIÓN: Contenedor Vectorial en lugar de <img> -->
        <div id="global-mascot-container" class="mascot-vector-container" aria-hidden="true">
            <!-- Por defecto: Superhéroe (Se reemplazará via JS si hay uno guardado) -->
            <svg viewBox="0 0 400 550" xmlns="http://www.w3.org/2000/svg" class="avatar-svg" aria-hidden="true">
                <path d="M130,140 Q60,250 80,450 L320,450 Q340,250 270,140 Z" fill="url(#globalCapeGradient)"/>
                <path d="M130,140 Q100,250 110,450 L140,450 Q130,300 150,140 Z" fill="#991B1B" opacity="0.4"/>
                <path d="M270,140 Q300,250 290,450 L260,450 Q270,300 250,140 Z" fill="#991B1B" opacity="0.4"/>
                <g transform="translate(0, -10)">
                    <path d="M165,280 Q150,350 155,400 L160,450 L195,450 L198,330 L190,280 Z" fill="url(#globalSuitGradient)"/>
                    <path d="M235,280 Q250,350 245,400 L240,450 L205,450 L202,330 L210,280 Z" fill="url(#globalSuitGradient)"/>
                    <path d="M158,380 L197,380 L195,450 L160,450 Z" fill="#DC2626"/>
                    <path d="M158,380 L178,400 L197,380" fill="#B91C1C"/>
                    <path d="M242,380 L203,380 L205,450 L240,450 Z" fill="#DC2626"/>
                    <path d="M242,380 L222,400 L203,380" fill="#B91C1C"/>
                </g>
                <path d="M165,270 L235,270 L235,290 L210,320 L190,320 L165,290 Z" fill="#1E40AF"/>
                <path d="M140,140 L260,140 L250,200 L235,280 L165,280 L150,200 Z" fill="url(#globalSuitGradient)"/>
                <path d="M150,180 Q200,210 250,180 Q200,230 150,180" fill="#172554" opacity="0.2"/>
                <path d="M200,180 L200,220" stroke="#172554" stroke-width="2" opacity="0.2"/>
                <path d="M185,230 L215,230 L210,245 L190,245 Z" fill="#172554" opacity="0.15"/>
                <path d="M188,250 L212,250 L210,265 L190,265 Z" fill="#172554" opacity="0.15"/>
                <rect x="165" y="270" width="70" height="15" fill="url(#globalGoldGradient)" rx="2"/>
                <circle cx="200" cy="277" r="12" fill="url(#globalGoldGradient)" stroke="#B45309" stroke-width="2"/>
                <path d="M195,272 L200,282 L205,272" fill="none" stroke="#B45309" stroke-width="2"/>
                <path d="M140,145 Q110,145 105,180 Q100,210 120,225" fill="none" stroke="url(#globalSkinGradient)" stroke-width="28" stroke-linecap="round"/>
                <circle cx="140" cy="150" r="22" fill="url(#globalSuitGradient)"/>
                <path d="M260,145 Q290,145 295,180 Q300,210 280,225" fill="none" stroke="url(#globalSkinGradient)" stroke-width="28" stroke-linecap="round"/>
                <circle cx="260" cy="150" r="22" fill="url(#globalSuitGradient)"/>
                <circle cx="120" cy="225" r="16" fill="#DC2626"/>
                <circle cx="280" cy="225" r="16" fill="#DC2626"/>
                <path d="M110,215 L130,215 L125,235 L115,235 Z" fill="#991B1B" opacity="0.5"/>
                <path d="M270,215 L290,215 L285,235 L275,235 Z" fill="#991B1B" opacity="0.5"/>
                <path d="M185,130 L215,130 L215,150 L185,150 Z" fill="#F5C19B"/>
                <path d="M185,145 Q200,155 215,145" fill="none" stroke="#E5B085" stroke-width="2"/>
                <path d="M175,80 L225,80 L225,100 Q225,135 200,135 Q175,135 175,100 Z" fill="url(#globalSkinGradient)"/>
                <ellipse cx="172" cy="100" rx="5" ry="8" fill="url(#globalSkinGradient)"/>
                <ellipse cx="228" cy="100" rx="5" ry="8" fill="url(#globalSkinGradient)"/>
                <path d="M175,80 L225,80 L225,95 Q225,115 200,115 Q175,115 175,95 Z" fill="#2563EB"/>
                <path d="M200,80 L200,90 L185,90" fill="none" stroke="#1D4ED8" stroke-width="1" opacity="0.5"/>
                <path d="M180,92 Q190,88 198,92 L196,98 L182,98 Z" fill="white"/>
                <path d="M202,92 Q210,88 220,92 L218,98 L204,98 Z" fill="white"/>
                <path d="M200,105 L196,115 L204,115 Z" fill="#E5B085" opacity="0.6"/>
                <path d="M190,125 Q200,128 210,125" fill="none" stroke="#A85D36" stroke-width="2" stroke-linecap="round"/>
                <path d="M192,128 L208,128" fill="none" stroke="#D69E76" stroke-width="1" opacity="0.5"/>
                <path d="M172,80 Q165,60 180,50 Q200,35 220,50 Q235,60 228,80 L225,80 Q200,60 175,80 Z" fill="#111827"/>
                <path d="M220,50 Q230,40 225,60" fill="none" stroke="#1F2937" stroke-width="2"/>
                <path d="M190,165 L210,165 L200,205 Z" fill="url(#globalGoldGradient)" stroke="#B45309" stroke-width="1"/>
                <path d="M194,170 L206,170 L200,195 Z" fill="#FEF3C7" opacity="0.4"/>
                <ellipse cx="260" cy="145" rx="10" ry="5" fill="white" opacity="0.2" transform="rotate(-45 260 145)"/>
                <ellipse cx="140" cy="145" rx="10" ry="5" fill="white" opacity="0.2" transform="rotate(45 140 145)"/>
            </svg>
        </div>
    </aside>

    <!-- Vinculamos la lógica específica de Ajustes -->
    <script src="../js/ajustes.js"></script>
</body>
</html>